var utvAdmin={};utvAdmin.initialize=function(a){utvAdmin.setupObjects(a),utvAdmin.setupFunctions(a),utvAdmin.setupEvents(a)},utvAdmin.setupEvents=function(a){a(function(){if(a("#utv-vid-data").length){var b=a("#utv-vid-data").val().split(":");(b.length=2)&&(utvAdmin.videomemory.vid=b[0]),utvAdmin.videomemory.source=b[1]}a("div.updated, div.e-message").delay(6e3).queue(function(){a(this).remove()}),a("#utv-videoadd-submit, #saveAlbum, #createGallery, #saveAlbumEdit, #saveGalleryEdit, #saveVideoEdit").click(function(){var b=a(this).parents("form");if(utvAdmin.checkForm(b))return!1}),a("#utv-videoadd-url").change(function(){var b=a("#utv-videoadd-source").val(),c=a(this).val();if(utvAdmin.videomemory.autoplay=0,""!=c){if("youtube"==b){utvAdmin.videomemory.source="youtube";var d=c.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);null!=d&&(utvAdmin.videomemory.vid=d[1])}else if("vimeo"==b){utvAdmin.videomemory.source="vimeo";var d=c.match(/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/);null!=d&&(utvAdmin.videomemory.vid=d[2])}}else utvAdmin.videomemory.source="",utvAdmin.videomemory.vid="";a("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),a("#utv-videoadd-starttime").change(function(){var b=a(this).val();isNaN(b)?(utvAdmin.videomemory.starttime="",a(this).val("")):(utvAdmin.videomemory.starttime=b,utvAdmin.videomemory.autoplay=1),a("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),a("#utv-videoadd-endtime").change(function(){var b=a(this).val();isNaN(b)?(utvAdmin.videomemory.endtime="",a(this).val("")):(utvAdmin.videomemory.endtime=b,utvAdmin.videomemory.autoplay=1),a("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),a("#utv-videoadd-source").change(function(){var b=a(this).val();utvAdmin.videomemory.autoplay=0,b!=utvAdmin.videomemory.source&&(utvAdmin.videomemory.source=b,a("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())),"youtube"==b?(a("#utv-videoadd-quality").parent("p").removeClass("utv-hide"),a("#utv-videoadd-chrome").parent("p").removeClass("utv-hide"),a("#utv-videoadd-endtime").parent("p").removeClass("utv-hide")):"vimeo"==b&&(a("#utv-videoadd-quality").parent("p").addClass("utv-hide"),a("#utv-videoadd-chrome").parent("p").addClass("utv-hide"),a("#utv-videoadd-endtime").parent("p").addClass("utv-hide"))}),a("#utv-album-thumb-select").on("click",".utv-album-thumb-choice",function(){var b=a(this);a("#utv-album-thumb-select .utv-album-thumb-choice").removeClass("utv-album-thumb-choice-active"),b.addClass("utv-album-thumb-choice-active");var c=b.find("img").attr("src"),d=c.replace(utvJSData.thumbCacheDirectory,"");d=d.replace(".jpg",""),a("#utv-album-selected-thumb").val(d),a("#utv-album-preview-thumb").attr("src",c)}),a("#utv-reset-overlay-color").click(function(){return a("#utv-overlay-color").val("#000"),!1}),a("#utv-reset-overlay-opacity").click(function(){return a("#utv-overlay-opacity").val("0.85"),!1}),a("#utv-reset-thumbnail-width").click(function(){return a("#utv-thumbnail-width").val("150"),!1}),a("#utv-reset-thumbnail-padding").click(function(){return a("#utv-thumbnail-padding").val("10"),!1}),a("#utv-reset-thumbnail-borderradius").click(function(){return a("#utv-thumbnail-borderradius").val("3"),!1}),a("#utv-reset-width").click(function(){return a("#utv-player-width").val("950"),a("#utv-player-height").val("537"),!1}),a("#utv-player-width").keyup(function(){a("#utv-player-height").val(Math.round(a("#utv-player-width").val()/1.77))}),a("#utv-player-height").keyup(function(){a("#utv-player-width").val(Math.round(1.77*a("#utv-player-height").val()))}),a(".ut-delete-gallery").click(function(){if(!confirm(utvJSData.translations.confirmGalleryDelete))return!1;var b=a(this).parents("tr"),c=b.attr("id"),d={action:"ut_deletegallery",key:c,nonce:utvJSData.nonces.deleteGallery};return a.post(ajaxurl,d,function(a){a&&b.fadeOut(400,function(){b.remove()})}),!1}),a("#utv-view-album .utv-sortable-table tbody").sortable({placeholder:"utv-sortable-placeholder",handle:".utv-sortable-handle",opacity:.8,containment:"parent",stop:function(b,c){var d=a("#utv-view-album .utv-sortable-table tbody").sortable("toArray").toString(),e={action:"utv_videoorderupdate",order:d};a.post(ajaxurl,e,function(a){})}}).disableSelection(),a(".ut-delete-video").click(function(){if(!confirm(utvJSData.translations.confirmVideoDelete))return!1;var b=a(this).parents("tr"),c=b.attr("id"),d=a("#utv-video-count"),e={action:"ut_deletevideo",key:c,nonce:utvJSData.nonces.deleteVideo};return a.post(ajaxurl,e,function(a){a&&(b.fadeOut(400,function(){b.remove()}),d.text(d.text()-1))}),!1}),a("#utv-view-album .utv-publish, #utv-view-album .utv-unpublish").click(function(){var b=a(this),c=b.parents("tr").attr("id"),d=b.hasClass("utv-publish")?"0":"1",e={action:"ut_publishvideo",key:c,changeTo:d,nonce:utvJSData.nonces.publishVideo};return utvAdmin.ajaxPubUnPubStatus(e,b),!1}),a("#utv-view-gallery .utv-sortable-table tbody").sortable({placeholder:"utv-sortable-placeholder",handle:".utv-sortable-handle",opacity:.8,containment:"parent",stop:function(b,c){var d=a("#utv-view-gallery .utv-sortable-table tbody").sortable("toArray").toString(),e={action:"utv_albumorderupdate",order:d};a.post(ajaxurl,e,function(a){})}}).disableSelection(),a(".ut-delete-album").click(function(){if(!confirm(utvJSData.translations.confirmAlbumDelete))return!1;var b=a(this).parents("tr"),c=b.attr("id"),d={action:"ut_deletealbum",key:c,nonce:utvJSData.nonces.deleteAlbum};return a.post(ajaxurl,d,function(a){a&&b.fadeOut(400,function(){b.remove()})}),!1}),a("#utv-view-gallery .utv-publish, #utv-view-gallery .utv-unpublish").click(function(){var b=a(this),c=b.parents("tr").attr("id"),d=b.hasClass("utv-publish")?"0":"1",e={action:"ut_publishalbum",key:c,changeTo:d,nonce:utvJSData.nonces.publishAlbum};return utvAdmin.ajaxPubUnPubStatus(e,b),!1}),a("#utv-playlistadd-source").change(function(){var b=a(this).val(),c=a("#utv-playlistadd-url").val(),d="";"youtube"==b?(a("#utv-playlistadd-quality").parent("p").removeClass("utv-hide"),a("#utv-playlistadd-chrome").parent("p").removeClass("utv-hide"),d="utv_fetchyoutubeplaylist"):"vimeo"==b&&(a("#utv-playlistadd-quality").parent("p").addClass("utv-hide"),a("#utv-playlistadd-chrome").parent("p").addClass("utv-hide"),d="utv_fetchvimeoplaylist"),""!=c&&b!=utvAdmin.playlistmemory.source&&(a("#utv-add-playlist").attr("disabled","disabled"),a("#utv-playlist-preview").html(""),a("#utv-playlist-preview-loader").removeClass("utv-hide"),utvAdmin.ajaxRetrievePlaylistData(c,d)),utvAdmin.playlistmemory.source=b}),a("#utv-playlistadd-url").change(function(){var b=a(this).val(),c=a("#utv-playlistadd-source").val();a("#utv-playlist-preview").html(""),a("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text("0"),a("#utv-add-playlist").removeAttr("disabled"),""!=b&&(a("#utv-add-playlist").attr("disabled","disabled"),a("#utv-playlist-preview-loader").removeClass("utv-hide"),"youtube"==c?utvAdmin.ajaxRetrievePlaylistData(b,"utv_fetchyoutubeplaylist"):utvAdmin.ajaxRetrievePlaylistData(b,"utv_fetchvimeoplaylist"))}),a("#utv-playlist-preview").on("click",".utv-playlist-choice",function(){var b=a(this);b.hasClass("utv-playlist-choice-active")?(utvAdmin.playlistmemory.selectedvideos--,b.removeClass("utv-playlist-choice-active")):(utvAdmin.playlistmemory.selectedvideos++,b.addClass("utv-playlist-choice-active")),a("#utv-playlist-preview-selectedcount").text(utvAdmin.playlistmemory.selectedvideos)}),a("#utv-add-playlist").click(function(){var b=a(this).parents("form"),c=a("#utv-playlist-preview .utv-playlist-choice-active"),d="",e="",f="";if(a.each(c,function(b,c){var g=a(c).next();d+=a(g).children(".utv-playlist-item-id").val()+"||",e+=a(g).children(".utv-playlist-item-title").val()+"||",f+=a(g).children(".utv-playlist-thumburl").val()+"||"}),d.length>0&&(d=d.slice(0,-2)),e.length>0&&(e=e.slice(0,-2)),f.length>0&&(f=f.slice(0,-2)),a("#utv-playlist-add-ids").val(d),a("#utv-playlist-add-titles").val(e),a("#utv-playlist-add-thumburls").val(f),utvAdmin.checkForm(b))return!1})})},utvAdmin.setupObjects=function(a){this.videomemory={source:"",vid:"",starttime:"",endtime:"",autoplay:"0"},this.playlistmemory={source:"",selectedvideos:""}},utvAdmin.setupFunctions=function(a){this.checkTextField=function(a){return""==a.val()?(a.addClass("utv-invalid-field"),!0):void a.removeClass("utv-invalid-field")},this.checkForm=function(b){var c=0;if(b.find('input[type="text"].utv-required').each(function(){utvAdmin.checkTextField(a(this))&&c++}),c>0)return!0},this.generateEmbedUrl=function(){return"youtube"==utvAdmin.videomemory.source?"https://www.youtube.com/embed/"+utvAdmin.videomemory.vid+"?modestbranding=1&rel=0&showinfo=0&autohide=0&iv_load_policy=3&color=white&theme=dark&rand="+utvAdmin.generateRandomInt()+"&autoplay="+utvAdmin.videomemory.autoplay+"&start="+utvAdmin.videomemory.starttime+"&end="+utvAdmin.videomemory.endtime:"vimeo"==utvAdmin.videomemory.source?"https://player.vimeo.com/video/"+utvAdmin.videomemory.vid+"?&title=0&portrait=0&byline=0badge=0&rand="+utvAdmin.generateRandomInt()+"&autoplay="+utvAdmin.videomemory.autoplay+"#t="+utvAdmin.videomemory.starttime:""},this.generateRandomInt=function(){return Math.floor(1e3*Math.random())},this.ajaxPubUnPubStatus=function(b,c){a.post(ajaxurl,b,function(a){a&&(c.hasClass("utv-publish")?(c.addClass("utv-unpublish"),c.removeClass("utv-publish")):(c.addClass("utv-publish"),c.removeClass("utv-unpublish")))})},this.ajaxRetrievePlaylistData=function(b,c){if(utvAdmin.notNull(b)&&utvAdmin.notNull(c)){var d={action:c,url:b,nonce:utvJSData.nonces.retrievePlaylist};a.post(ajaxurl,d,function(b){if(b&&b.valid&&b.data.length>0){utvAdmin.playlistmemory.selectedvideos=b.data.length;for(var c="",d=0;d<b.data.length;d++)c+='<div class="utv-playlist-preview-item">                            <span class="utv-playlist-preview-item-num">'+(d+1)+')</span>                            <div class="utv-playlist-choice utv-playlist-choice-active">                                <img src="'+b.data[d].thumbURL+'"/>                                <span class="utv-playlist-choice-overlay"></span>                            </div>                            <div class="utv-playlist-preview-form">                                <input type="text" class="utv-playlist-item-title" value="'+b.data[d].title+'"/>                                <span class="utv-playlist-item-duration">'+b.data[d].duration+'</span>                                <input type="hidden" class="utv-playlist-item-id" value="'+b.data[d].videoId+'"/>                                <input type="hidden" class="utv-playlist-thumburl" value="'+b.data[d].thumbURL+'"/>                            </div>                        </div>';a("#utv-playlist-preview-loader").addClass("utv-hide"),a("#utv-playlist-preview").html(c),a("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text(b.data.length),utvAdmin.setErrorMessage(a("#utv-add-playlist-message"),""),a("#utv-add-playlist").removeAttr("disabled")}else a("#utv-playlist-preview-loader").addClass("utv-hide"),a("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text("0"),utvAdmin.setErrorMessage(a("#utv-add-playlist-message"),b.message)})}},this.notNull=function(a){return void 0!=a&&""!=a},this.setErrorMessage=function(a,b){utvAdmin.notNull(a)&&a.text(b)}},function(a){utvAdmin.initialize(a)}(jQuery);
